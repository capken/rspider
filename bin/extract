#!/usr/bin/env ruby
# -*- coding: UTF-8 -*-

require File.expand_path(File.dirname(__FILE__)) + "/../config/load"

@cache = CACHE::FileSystem.new
@logger = Logger.new(STDOUT)
@extractor = Extractor::Base.new

STDIN.each do |line|
  url = line.strip

  if @cache.exists? url
    body = @cache.get(url)
    record = @extractor.select url, body
    record["url"] = url

    puts record.to_json
  end
end

